Для построения доверительного интервала для среднего значения нужно выполнить следующие три шага:
1. Оценить среднее значение по исходным данным;
2. С помощью [[Bootstrap]] оценить квантили;
3. Подставить их в формулу для нормального доверительного интервала.

``` python
def get_ci_bootstrap_normal(boot_metrics: np.array, pe_metric: float, alpha: float=0.05):
    """Строит нормальный доверительный интервал.

    boot_metrics - значения метрики, полученные с помощью бутстрепа
    pe_metric - точечная оценка метрики
    alpha - уровень значимости
    
    return: (left, right) - границы доверительного интервала.
    """
    c = stats.norm.ppf(1 - alpha / 2)
    se = np.std(boot_metrics)
    left, right = pe_metric - c * se, pe_metric + c * se
    return left, right


def get_ci_bootstrap_percentile(boot_metrics: np.array, pe_metric: float, alpha: float=0.05):
    """Строит доверительный интервал на процентилях.

    boot_metrics - значения метрики, полученные с помощью бутстрепа
    pe_metric - точечная оценка метрики
    alpha - уровень значимости
    
    return: (left, right) - границы доверительного интервала.
    """
    left, right = np.quantile(boot_metrics, [alpha / 2, 1 - alpha / 2])
    return left, right


def get_ci_bootstrap_pivotal(boot_metrics: np.array, pe_metric: float, alpha: float=0.05):
    """Строит центральный доверительный интервал.

    boot_metrics - значения метрики, полученные с помощью бутстрепа
    pe_metric - точечная оценка метрики
    alpha - уровень значимости
    
    return: (left, right) - границы доверительного интервала.
    """
    right, left = 2 * pe_metric - np.quantile(boot_metrics, [alpha / 2, 1 - alpha / 2])
    return left, right
```

> Доверительные интервалы всегда сопровождаются уровнем покрытия, выраженным (высоким) процентом, скажем, 90 или 95%. 90-процентный доверительный интервал можно представить следующим образом: это интервал, который окружает центральные 90% бутстраповского выборочного распределения выборочной статистики (см. разд. "Бутстрап" ранее в этой главе). Более широко, x-процентный доверительный интервал вокруг выборочной оценки должен в среднем содержать аналогичные выборочные оценки x% случаев (когда выполнена аналогичная процедура отбора).
> Процент, связанный с доверительным интервалом, называется уровнем доверия. Чем выше уровень доверия, тем шире интервал. Кроме того, чем меньше выборка, тем шире интервал (т. е. больше неопределенности). Оба свойства достаточно логичны: чем больше вы хотите быть уверенным, и чем меньше данных у вас есть, тем шире следует сделать доверительный интервал, чтобы быть достаточно уверенным в получении истинного значения.
> [[0. Books/Практическая статистика для специалистов Data Science/0. cover]]

